#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include "utils.h"
#include "cholesky.h"
#include "riscv_vector.h"

#define n 5

int main() {

  float A[n*n] = { 1.52282485, -1.33105524, -0.46328294, -0.66219897, -1.35410243,
     -1.33105524,  2.29722519,  0.56088177,  0.84563591,  1.69904816,
     -0.46328294,  0.56088177,  0.96620711,  0.20347949,  0.37860907,
     -0.66219897,  0.84563591,  0.20347949,  0.59777389,  0.83557352,
     -1.35410243,  1.69904816,  0.37860907,  0.83557352,  2.24178834};

  float gold[n*n] = {1.23402786, -1.33105528, -0.46328294, -0.66219896, -1.35410237,
                    -1.07862663, 1.06479561, 0.56088179, 0.84563589, 1.69904816,
                    -0.37542340, 0.14645074, 0.89655817, 0.20347948, 0.37860906,
                    -0.53661591, 0.25059050, -0.03867887, 0.49550542, 0.83557349,
                    -1.09730291, 0.48410040, -0.11626796, 0.24406435, 0.85456181};

  cholesky(A, n);

  int err;
  for (int r= 0; r < n; r++) {
    for (int c = 0; c < r; c++) {
      err += abs(A[r*n + c] - gold[r*n+c]);
    }
  }

  if(err<1e-5) {
    printf("Cholesky SUCCESSFUL\n");
  } else {
    printf("Cholesky FAILED: error \n. err");
  }

  print_matrix(A, n, n);

  /* code */
  return 0;
}